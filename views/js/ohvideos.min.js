var _ohSites = [];
_ohSites.push({
	identifier: "gifv",
	noJS: true
});

_ohSites.push({
	identifier: "vimeo",
	embedUrl: "//player.vimeo.com/video/{video_id}?autoplay=1",
	requestUrl: "https://vimeo.com/{video_id}"
});

_ohSites.push({
	identifier: "youtube",
	embedUrl: "//www.youtube.com/embed/{video_id}?autoplay=1&autohide=1",
	requestUrl: "https://www.youtube.com/watch?v={video_id}"
});
var _oh=function(){this.masterDiv=$(".oharaEmbed");this.basedElement=this.masterDiv.parent();this.defaultWidth="undefined"!==typeof _ohWidth?_ohWidth:480;this.defaultHeight="undefined"!==typeof _ohHeight?_ohHeight:270;this.aspectRatio=this.defaultHeight/this.defaultWidth;this.main();this.responsive()};_oh.prototype.getIframe=function(a){return iframe=$("<iframe/>",{frameborder:"0",src:a.embedUrl,width:this.defaultWidth,height:this.defaultHeight,allowfullscreen:"","class":"oharaEmbedIframe"})};
_oh.prototype.main=function(){_ohMain=this;$.each(_ohSites,function(a,b){$("."+b.identifier).each(function(a,c){if("undefined"!==typeof b.noJS)return!1;c.domElement=$(this);c=$.extend(c,$.parseJSON(decodeURIComponent(c.domElement.data("ohara_"+b.identifier))));c.embedUrl=b.embedUrl.replace("{video_id}",c.video_id);c.requestUrl=b.requestUrl.replace("{video_id}",c.video_id);"function"==typeof b.getData?b.getData(_ohMain,c):_ohMain.getData(c);"function"==typeof b.createVideo?b.createVideo(_ohMain,c):
(c.domElement.append($("<div/>",{"class":"oharaEmbed_play"})),c.domElement.on("click",function(){$(this).html(_ohMain.getIframe(c));_ohMain.responsive()}))})});_ohMain.responsive()};_oh.prototype.getData=function(a){$.getJSON("https://noembed.com/embed",{format:"json",url:a.requestUrl},function(b){title=$("<div/>",{"class":"oharaEmbed_title"}).html(b.title);a.domElement.css({"background-image":"url("+b.thumbnail_url+")","background-size":"cover"});a.domElement.append(title)})};
_oh.prototype.responsive=function(){_ohResponsive=this;$(window).resize(function(){var a=_ohResponsive.basedElement.width(),b=a*_ohResponsive.aspectRatio<=_ohResponsive.defaultHeight?a*_ohResponsive.aspectRatio:_ohResponsive.defaultHeight,d=a<=_ohResponsive.defaultWidth,c=d?a:_ohResponsive.defaultWidth,e=d?b:_ohResponsive.defaultHeight;_ohResponsive.masterDiv.width(c).height(e);$("iframe.oharaEmbedIframe").each(function(){$(this).width(c).height(e)})}).resize()};
_oh.prototype.refresh=function(a){a="undefined"!==typeof a?a:3E3;_ohRefresh=this;setTimeout(function(){_ohRefresh.main()},a);setTimeout(function(){_ohRefresh.responsive()},a)};function oh_refresh(a){var b=b||new _oh;b.refresh()}
"undefined"!==typeof $.sceditor&&($.sceditor.plugins.bbcode.bbcode.set("youtube",{allowsEmpty:!0,tags:{iframe:{"data-youtube-id":null}},format:function(a,b){return(a=a.attr("data-youtube-id"))?"[youtube]"+a+"[/youtube]":b},html:function(a,b,d){return(match=d.match(/(^[a-zA-z0-9_-]{11})$/)||d.match(/(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com(?:\/embed\/|\/v\/|\/watch\?v=|\/watch\?.+&v=))([\w-]{11})(?:.+)?$/)||d.match(/(?:youtube(?:-nocookie)?\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/))?
'<iframe frameborder="0" src="//www.youtube.com/embed/'+match[1]+'?autoplay=0&autohide=1" data-youtube-id="'+d+'" allowfullscreen class="oharaEmbedIframe" style="width: 420px; height: 315px;"></iframe>':d}}),$.sceditor.plugins.bbcode.bbcode.set("vimeo",{allowsEmpty:!0,tags:{iframe:{"data-vimeo-id":null}},format:function(a,b){return(a=a.attr("data-vimeo-id"))?"[vimeo]"+a+"[/vimeo]":b},html:function(a,b,d){return(match=d.match(/(^\d+$)/)||d.match(/(?:https?:\/\/)?(?:www\.)?(?:player\.)?vimeo\.com\/(?:[a-z]*\/)*([0-9]{6,11})[?]?.*/))?
'<iframe frameborder="0" src="//player.vimeo.com/video/'+match[1]+'?autoplay=0" data-vimeo-id="'+d+'" allowfullscreen class="oharaEmbedIframe" style="width: 420px; height: 315px;"></iframe>':d}}));(function(a){a(function(){var b=new _oh;a(document).on("click","input[name=preview], input[name=post]",function(){b.refresh()})})})(jQuery);